<!DOCTYPE html>
<html>
  <head>
    <title>Messaging API</title>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
    <script src='https://www.w3.org/Tools/respec/respec-w3c-common' class='remove'></script>
    <script class="remove">
      var respecConfig = {
          specStatus:           "ED",
          shortName:            "messaging-api",
          publishDate:          "",
          previousPublishDate:  "",
          previousMaturity:     "",
          edDraftURI:           "http://www.w3.org/2012/sysapps/",
          // lcEnd:                "",
          crEnd:                "",
          editors:  [
              { name: "Eduardo Fullea", company: "Telefonica", companyURL: "http://www.tid.es/" },
              { name: "Jose M. Cantera", company: "Telefonica", companyURL: "http://www.tid.es/" },
              { name: "Mounir Lamouri", company: "Mozilla", companyURL: "http://mozilla.org/" }
         ],
          inlineCSS:    true,
          noIDLIn:      true,
          extraCSS:     ["../ReSpec.js/css/respec.css"],
          wg:           "System Applications Working Group",
          wgURI:        "http://",
          wgPublicList: "public-sysapps",
          wgPatentURI:  "http://www.w3.org/2004/01/pp-impl/43696/status",
      };
    </script>
  </head>
  <body>
    <section id="abstract">
      This specification defines a System Level API which offers a simple interface to get access to mobile messaging services.
      A typical use case of the Messaging API is the implementation of a messaging client application that allows the user
      send SMS and MMS messages as well as to access and manage the received SMS and MMS messages.
    </section>
    
    <section id="sotd">
    </section>
    
    <section class="informative">
      <h2>Introduction</h2>
      <p>
        The Messaging API provides operations to get access to the primitives offered by mobile messaging services
        (send, receive) as well as those that allow to manage a mobile messaging client inbox (delete, store, mark as read)
      <p>
        An example of use is provided below:
      
      <pre class="example highlight">
            var sms_send_request = navigator.messaging.sendSMS( var sms_recipients = ['+34638883076'] ; var sms_content = { text : 'How are you?'} );
            sms_send_request.onsuccess = function() { 
                        window.console.log('Message Sent!'); 
            }
            sms_send_request.onerror = function(e) {
                    window.console.error(e.target.error.name);
            }

      </pre>
    </section>
    
    <section id="conformance">
      <p>This specification defines conformance criteria that apply to a single product: the <dfn>user agent</dfn> that
      implements the interfaces that it contains.
      
      <p>Implementations that use ECMAScript to implement the APIs defined in this specification MUST implement them in
      a manner consistent with the ECMAScript Bindings defined in the Web IDL specification [[!WEBIDL]], as this
      specification uses that specification and terminology.
      
    </section>
    
    <section>
      <h2>Terminology</h2>
      <p>The <code><a href="http://dev.w3.org/html5/spec/webappapis.html#eventhandler"> EventHandler</a></code>
      interface represents a callback used for event handlers as defined in [[!HTML5]].
      
      <p>The concepts <dfn><a href="http://dev.w3.org/html5/spec/webappapis.html#queue-a-task"> queue a task</a></dfn>
      and <dfn><a href="http://dev.w3.org/html5/spec/webappapis.html#fire-a-simple-event"> fire a simple event</a></dfn>
      are defined in [[!HTML5]].
      
      <p>The terms <dfn><a href="http://dev.w3.org/html5/spec/webappapis.html#event-handlers"> event handler</a></dfn>
      and <dfn><a href="http://dev.w3.org/html5/spec/webappapis.html#event-handler-event-type"> event handler event
      types</a></dfn> are defined in [[!HTML5]].
      
    </section>

    <section>
      <h2>Security and privacy considerations</h2>
      <p>This API must be only exposed to trusted content
      
    </section>

    <section>
      <h2><a>Navigator</a> Interface</h2>
        <dl title="partial interface Navigator" class="idl">
          <dt>readonly attribute MobileMessagingManager messaging</dt>
          <dd>
          The object that exposes the interface to mobile messaging services.
          </dd>
      </dl>
    </section>
    
    <section>
      <h2><a>MobileMessagingManager</a> Interface</h2>
      <p>The <a>MobileMessagingManager</a> interface represents the initial entry point for getting access to the mobile
      messaging services, i.e. SMS and MMS.
      
      <dl title="[NoInterfaceObject] interface MobileMessagingManager : EventTarget" class="idl">

        <dt> SmsSegmentInfo getSegmentInfoForText ()</dt>
        <dd>This method returns an SmsSegmentInfo object including informtation on the number of concatenated SMS
        segments needed to send a given text, the number of characters available per segment and the maximum number of
        available characters in the last segment.
          <dl class='parameters'>
             <dt>DOMString text</dt>
             <dd>
               Text intended to be sent as an SMS, whose segmentation information is checked by this method
             </dd>
         </dl>
        </dd>
        
        <dt> MessagingRequest sendSMS ()</dt>
        <dd>This method issues a request to the messaging system to send an SMS
        message with the text of the <code>text</code> attribute of the <code>content</code> parameter to the
        destination number indicated in the <code>to</code> parameter.
        A <code>MessagingRequest</code> object will be returned in order to notify the result of the request.
          <dl class='parameters'>
             <dt>DOMString to</dt>
             <dd>
               Destination number for the SMS message 
             </dd>
             <dt>SmsContent content</dt>
             <dd>
               Content of the SMS message to be sent
             </dd>
         </dl>
        </dd>

        <dt> MessagingRequest sendMMS ()</dt>
        <dd>This method issues a request to the messaging system to send an MMS
        message with the content included in the <code>content</code> parameter to the destination numbers indicated
        in the <code>to</code> array parameter.
        A <code>MessagingRequest</code> object will be returned in order to notify the result of the request.
        <dl class='parameters'>
             <dt>DOMString[] to</dt>
             <dd>
               Destination numbers for the MMS message
             </dd>
             <dt>MmsContent content</dt>
             <dd>
               Content of the MMS message to be sent
             </dd>
         </dl>
        </dd>

        <dt> MessagingRequest getMessage ()</dt>
        <dd>This method makes a request to retrieve the SMS or MMS message identified by the <code>id</code> parameter.
        It returns a new <code>MessagingRequest</code> object which allows the caller to be notified about the result of the operation.
          <dl class='parameters'>
             <dt>long id</dt>
             <dd>
               Unique identifier of the SMS or MMS message that is requested to be retrieved
             </dd>
         </dl>
        </dd>

        <dt> MessagingRequest getMessages ()</dt>
        <dd>This method makes a request to retrieve the SMS and/or MMS messages matching the filter described by the
        <code>filter</code> parameter and ordering them by ascending or descending timestamp (depending on the value of
        the <code>reverse</code> parameter).
        It returns a new <code>MessagingRequest</code> that will be used to notify the caller about the result of the operation.
          <dl class='parameters'>
             <dt>MessagingFilter filter</dt>
             <dd>
               Filter that identifies the set of messages that are requested to be retrieved
             </dd>
             <dt>boolean reverse</dt>
             <dd>
              Indicates whether the set of retrieved messages are going to be sorted by timestamp in ascending  (if 'false')
              or descending order (if 'true').
             </dd>
         </dl>
        </dd>

        <dt> MessagingRequest delete ()</dt>
        <dd>This method requests the deletion of the SMS or MMS messages with identifiers equal to the indicated in the
        <code>id</code> array parameter.
        A new <code>MessagingRequest</code> is returned in order to notify the request result (success or error) to the caller.
          <dl class='parameters'>
             <dt>long[] id</dt>
             <dd>
               Array including unique identifiers of the messages that are requested to be deleted
             </dd>
         </dl>
        </dd>

        <dt> MessagingRequest markAsRead ()</dt>
        <dd>This method requests to mark as read or unread the SMS or MMS message with identifier equal to the
        indicated in the <code>id</code> parameter. The method returns a new <code>MessagingRequest</code>
        that will allow the caller to be notified about the result (success, error) of the operation.
          <dl class='parameters'>
             <dt>long[] id</dt>
             <dd>
               Array including unique identifiers of the messages that are requested to be marked as read or unread
             </dd>
             <dt>boolean value</dt>
             <dd>
              Indicates whether the SMS or MMS messages are to be marked as read (if 'true') or unread (if 'false')
             </dd>
         </dl>
        </dd>

        <dt> MessagingRequest retrieveMMS ()</dt>
        <dd>This method requests to download an MMS message with identifier equal to the
        indicated in the <code>id</code> parameter from the URL indicated in the MMS notification.
        The method returns a new <code>MessagingRequest</code>
        that will allow the caller to be notified about the result (success, error) of the operation.
          <dl class='parameters'>
             <dt>long id</dt>
             <dd>
               Identifier of the MMS message that is requested to be download
             </dd>
         </dl>
        </dd>

        <dt class="no-docs">
          attribute EventHandler onreceived
        </dt>
        <dd></dd>

        <dt class="no-docs">
          attribute EventHandler onsent
        </dt>
        <dd></dd>

        <dt class="no-docs">
          attribute EventHandler ondeliverysuccess
        </dt>
        <dd></dd>
 
        <dt class="no-docs">
          attribute EventHandler ondeliveryfailure
        </dt>
        <dd></dd>
      </dl>
 
      <p> The <dfn><code>sendSMS</code></dfn> method when invoked MUST run the following steps:
        <ol>
         <li>Create a new instance of <code>SmsMessage</code> and a new instance of <code>MessagingRequest</code> and:
         <ol>
          <li>generate a unique identifier for this message
          <li>set the <code>id</code> of the <code>SmsMessage</code> to the generated identifier
          <li>set the <code>state</code> of the <code>SmsMessage</code> to 'sending'
          <li>set the <code>deliveryStatus</code> of the <code>SmsMessage</code> to 'pending' if a delivery report has
          been requested or to 'not-applicable' otherwise.
          <li>set the <code>sender</code> of the <code>SmsMessage</code> to the number of the mobile subscription used to
          send this SMS message
          <li>set the <code>recipient</code> of the <code>SmsMessage</code> to the value of the <code>to</code> parameter
          <li>set the <code>content</code> of the <code>SmsMessage</code> to the value of the <code>content</code>
          parameter
          <li>set the <code>read</code> of the <code>SmsMessage</code> to 'true'
          <li>Make a request to the system to send an SMS message with text passed in the <code>message</code>
         parameter to the number of the recipient indicated in the <code>to</code> parameter.
          <li>set <code>readyState</code> of the <code>MessagingRequest</code> object to 'processing'
          <li>return the <code>MessagingRequest</code> to the caller and <a>queue a task</a> to monitor SMS sending progress
         </ol>
         <li>If there is an error set the <code>state</code> and the <code>deliveryStatus</code> elements of the
         <code>SmsMessage</code> to 'error' and invoke the <code>onerror</code> <a>event handler</a> of
         the <code>MessagingRequest</code> object
         <li>When the requests has been completed:
         <ol>
          <li>set the <code>state</code> of the <code>SmsMessage</code> to 'sent'
          <li>set the <code>timestamp</code> of the <code>SmsMessage</code> to the timestamp when the SMS message was
          actually sent
          <li>set the <code>readyState</code> of the <code>MessagingRequest</code> object to 'done'
          <li>set the <code>result</code> of the <code>MessagingRequest</code> object to the <code>SmsMessage</code>
          that has been sent
          <li>invoke the <code>onsuccess</code> <a>event handler</a> of the <code>MessagingRequest</code>
         </ol>
        </ol>
        
      <p> The <dfn><code>sendMMS</code></dfn> method when invoked MUST run the following steps:
        <ol>
         <li>Create a new instance of <code>MmsMessage</code> and a new instance of <code>MessagingRequest</code> and:
         <ol>
          <li>generate a unique identifier for this message
          <li>set the <code>id</code> of the <code>MmsMessage</code> to the generated identifier
          <li>set the <code>state</code> of the <code>MmsMessage</code> to 'sending'
          <li>add a new element in the <code>deliveryStatus</code> array of the <code>MmsMessage</code> for each of the
          addresses included in the <code>to</code> parameter, with value 'pending' if a delivery report has been
          requested or 'not-applicable' otherwise.
          <li>set the <code>sender</code> of the <code>MmsMessage</code> to the number of the mobile subscription used to
          send this MMS message
          <li>add a new element in the <code>recipients</code> array of the <code>MmsMessage</code> for each of the
          addresses included in the <code>to</code> parameter
          <li>set the <code>content</code> of the <code>MmsMessage</code> to the value of the <code>content</code>
          parameter
          <li>set the <code>read</code> of the <code>MmsMessage</code> to 'true'
          <li>Make a request to the system to send an MMS message with the content passed in the <code>content</code>
         parameter to the number(s) of indicated in the <code>to</code> parameter.
          <li>set <code>readyState</code> of the <code>MessagingRequest</code> object to 'processing'
          <li>return the <code>MessagingRequest</code> to the caller and <a>queue a task</a> to monitor MMS sending progress
         </ol>
         <li>If there is an error set the <code>state</code> element and the different elements in the
         <code>deliveryStatus</code> array of the <code>MmsMessage</code> to 'error' and invoke the <code>onerror</code>
         <a>event handler</a> of the <code>MessagingRequest</code> object
         <li>When the requests has been completed:
         <ol>
          <li>set the <code>state</code> of the <code>MmsMessage</code> to 'sent'
          <li>set the <code>timestamp</code> of the <code>MmsMessage</code> to the timestamp when the MMS message was
          actually sent
          <li>set the <code>readyState</code> of the <code>MessagingRequest</code> object to 'done'
          <li>set the <code>result</code> of the <code>MessagingRequest</code> object to the <code>MmsMessage</code>
          that has been sent
          <li>invoke the <code>onsuccess</code> <a>event handler</a> of the <code>MessagingRequest</code>
         </ol>
        </ol>
        
      <p> The <dfn><code>getMessage</code></dfn> method when invoked MUST run the following steps:
        <ol>
         <li>Make a request to the system to get the SMS or MMS message with identifier equal to the <code>id</code>
         parameter passed in the request.
         <li>Create a new <code>MessagingRequest</code> object and set <code>readyState</code> of the
         <code>MessagingRequest</code> object to 'processing' and return the <code>MessagingRequest</code> to the caller 
         <li>If there is an error invoke the <code>onerror</code> <a>event handler</a> of the <code>MessagingRequest</code>
         object
         <li>When the request has been completed:
         <ol>
          <li>set the <code>readyState</code> of the <code>MessagingRequest</code> object to 'done'
          <li>set the <code>result</code> of the <code>MessagingRequest</code> object to the <code>SmsMessage</code> or
          <code>MmsMessage</code> whose identifier matches the <code>id</code> parameter
          <li>invoke the <code>onsuccess</code> <a>event handler</a> of the <code>MessagingRequest</code>
        </ol>
       </ol>
 
      <p> The <dfn><code>getMessages</code></dfn> method when invoked MUST run the following steps:
        <ol>
         <li>Make a request to the system to get the SMS and/or MMS message(s) matching the resulting filter and to sort
         them by timestamp with the older message first if the <code>reverse</code> parameter is 'false' or last if
         it is 'true'.
         <li>Create a new <code>MessagingRequest</code> object and set <code>readyState</code> of the
         <code>MessagingRequest</code> object to 'processing' and return the <code>MessagingRequest</code> to the caller
         <li>If there is an error invoke the <code>onerror</code> <a>event handler</a> of the <code>MessagingRequest</code>
         object
         <li>When the request has been completed:
         <ol>
          <li>set the <code>readyState</code> of the <code>MessagingRequest</code> object to 'done'
          <li>set the <code>result</code> of the <code>MessagingRequest</code> object to an <code>MessagingCursor</code>
              providing access to the results of the retrieval
          <li>invoke the <code>onsuccess</code> <a>event handler</a> of the <code>MessagingRequest</code>
        </ol>
       </ol>
         
      <p>When the task in charge of monitoring the SMS or MMS sending progress is notified of message being successfully
      sent it MUST <a>queue a task</a> to <a>fire a simple event</a> named <code>sent</code> with the
      <code>message</code> attribute set to the sent <code>SmsMessage</code> or <code>MmsMessage</code>.
      
      <p> The <dfn><code>delete</code></dfn> method when invoked MUST run the following steps:
        <ol>
         <li>Make a request to the system to delete the set of messages with identifiers equal to the identifiers
         included in the <code>id</code> parameter passed in the request
         <li>Create a new <code>MessagingRequest</code> object and set <code>readyState</code> of the
         <code>MessagingRequest</code> object to 'processing' and return the <code>MessagingRequest</code> to the caller
         <li>If there is an error invoke the <code>onerror</code> <a>event handler</a> of the <code>MessagingRequest</code>
         object
         <li>When the request has been completed:
         <ol>
          <li>set the <code>readyState</code> of the <code>MessagingRequest</code> object to 'done'
          <li>set the <code>result</code> of the <code>MessagingRequest</code> object to 'true'
          <li>invoke the <code>onsuccess</code> <a>event handler</a> of the <code>MessagingRequest</code>
        </ol>
       </ol>

      <p> The <dfn><code>markAsRead</code></dfn> method when invoked MUST run the following steps:
        <ol>
         <li>Make a request to the system to mark as read/unread (depending on the <code>value</code> parameter being
         respectively 'true' or 'false') the set of messages with identifiers equal to the identifiers
         included in the <code>id</code> parameter passed in the request.
         <li>Create a new <code>MessagingRequest</code> object and set <code>readyState</code> of the
         <code>MessagingRequest</code> object to 'processing' and return the <code>MessagingRequest</code> to the caller
         <li>If there is an error invoke the <code>onerror</code> <a>event handler</a> of the <code>MessagingRequest</code>
         object
         <li>When the request has been completed:
         <ol>
          <li>set the <code>readyState</code> of the <code>MessagingRequest</code> object to 'done'
          <li>set the <code>result</code> of the <code>MessagingRequest</code> object to 'true'
          <li>invoke the <code>onsuccess</code> <a>event handler</a> of the <code>MessagingRequest</code>
        </ol>
       </ol>

       <p> The <dfn><code>retrieveMMS</code></dfn> method when invoked MUST run the following steps:
        <ol>
         <li>Make a request to the system to fetch the MMS message with identifier equal to the <code>id</code>
         parameter passed in the request, if the <code>id</code> parameter matches with an MMS message that has not yet
         been fetched.
         <li>Create a new <code>MessagingRequest</code> object and set <code>readyState</code> of the
         <code>MessagingRequest</code> object to 'processing' and return the <code>MessagingRequest</code> to the caller
         <li>If there is an error invoke the <code>onerror</code> <a>event handler</a> of the <code>MessagingRequest</code>
         object
         <li>When the request has been completed:
         <ol>
          <li>set the <code>readyState</code> of the <code>MessagingRequest</code> object to 'done'
          <li>set the <code>result</code> of the <code>MessagingRequest</code> object to 'true'
          <li>invoke the <code>onsuccess</code> <a>event handler</a> of the <code>MessagingRequest</code>
        </ol>
       </ol>
        
      <p> The <dfn><code>getSegmentInfoForText</code></dfn> method when invoked MUST return a SmsSegmentInfo object that
      contains the following elements
        <ol>
         <li>a <code>segments</code> element indicating the number of concatenated SMS segments needed to send the text
         passed in the <code>text</code> parameter, taking into account the encoding to be used to send such message as
         well as the overhead associated to concatenated SMS messages.
         Note that the application SHOULD NOT split the text in a set of strings that fit each into a single SMS
         segment as it would result in different independent SMS messages being sent, but SHOULD instead send the full message
         in a single <code>sendSMS</code> request. However having information on the number of SMS segments
         may be required by the application in order to inform the user (e.g. in case the length of the text impacts on the price
         charged for sending the message).
         <li>a <code>charsPerSegment</code> element indicating the number of characters available per SMS segment. This
         number depends on the encoding to be used to send the SMS message, which in turn depends on the language /
         special characters included in the text.
         <li>a <code>charsAvailableInLastSegment</code> element indicating the maximum number of available characters in
         the last segment that would be needed to send the input string. This provides useful information to the user on
         the number of characters that can type without requiring an additional SMS segment to send the text.
       </ol>
      
      <p>Upon a new SMS message being received, the <a>user agent</a> MUST:
        <ol>
          <li>create a new instance of <code>SmsMessage</code>
          <li>generate a unique identifier for this message
          <li>set the <code>id</code> of the <code>SmsMessage</code> to the generated identifier
          <li>set the <code>state</code> of the <code>SmsMessage</code> to 'received'
          <li>set the <code>sender</code> of the <code>SmsMessage</code> to the sender of the SMS message
          <li>set the <code>recipient</code> of the <code>SmsMessage</code> to the recipient of the SMS message
          <li>set the <code>timestamp</code> of the <code>SmsMessage</code> to  the timestamp of the SMS message
          <li>set the <code>messageClass</code> of the <code>SmsMessage</code> to  the messageClass of the SMS message
          <li>set the <code>read</code> of the <code>SmsMessage</code> to 'false'
          <li>fill the <code>content</code> element of the <code>SmsMessage</code> as follows:
          <ol>
            <li>set the <code>text</code> element to the text of the received SMS message
          </ol> 
          <li><a>queue a task</a> to <a>fire an event</a> named <code><a>received</a></code> with the
          <code>message</code> attribute set to the newly created <code>SmsMessage</code> instance.
        </ol>
      
      <p>Upon a new MMS message being received, the <a>user agent</a> MUST:
        <ol>
          <li>create a new instance of <code>MmsMessage</code>
          <li>generate a unique identifier for this message
          <li>set the <code>id</code> of the <code>MmsMessage</code> to the generated identifier
          <li>set the <code>state</code> of the <code>MmsMessage</code> to 'received' if the message has been downloaded
          or otherwise to 'not-downloaded'
          <li>set the <code>sender</code> of the <code>MmsMessage</code> to the sender of the MMS message
          <li>add a new element in the <code>recipients</code> array of the <code>MmsMessage</code> for each of recipients
          of the MMS message (in any of the To, Cc or Bcc fields)
          <li>set the <code>timestamp</code> of the <code>MmsMessage</code> to  the timestamp of the MMS message
          <li>set the <code>read</code> of the <code>MmsMessage</code> to 'false'
          <li>fill the <code>content</code> element of the <code>MmsMessage</code> as follows:
          <ol>
            <li>set the <code>subject</code> element to the subject of the received MMS message, if present
            <li>create a new <code>Document</code> object containing the SMIL object of the received MMS message,
            if present
            <li>set the <code>smil</code> element to the <code>Document</code> object generated in the previous step
            <li>for each of the media files attached to the received MMS message add a new element to the MmsAttachment
            array with:
            <ol>
              <li>a new <code>Blob</code> object including the media type and the actual content of the attachment.
              <li>the <code>contentID</code> attribute filled with the Content-ID associated to this element in the
              incoming MMS message, if present, and that may be used to reference this element from the SMIL object
              <li>the <code>contentLocation</code> attribute filled with the Content-Location associated to this element in the
              incoming MMS message, if present, and that may be used to reference this element from the SMIL object
            </ol>
          </ol>
          <li><a>queue a task</a> to <a>fire an event</a> named <code><a>received</a></code> with the
          <code>message</code> attribute set to the newly created <code>MmsMessage</code> instance.
        </ol>
      
      <p>Upon a delivery report of a previously sent message being received, the <a>user agent</a> MUST
        <ol>
          <li>in case of being related to an <code>SmsMessage</code> set the <code>deliveryStatus</code> to 'success' or
          'error' depending on the reported result.
          <li>in case of being related to an <code>MmsMessage</code> set the elements of <code>deliveryStatus</code> of
          the recipients to which the delivery report refers to 'success' or 'error' depending on the reported result.
          <li><a>queue a task</a> to <a>fire a simple event</a> named <a>deliverysuccess</a> or <a>deliveryfailure</a> respectively
          if the delivery was successfull or not, with the <code>id</code> attribute set to the identifier of the
          <code>SmsMessage</code> or <code>MmsMessage</code> to which this confirmation is related, and the <code>recipients</code>
          attribute set to the subset of the original recipients of the message to which the delivery report is related.
        </ol>
      
      <section>
        <h2>Event handlers</h2>
        <p>The following are the <a>event handlers</a> (and their corresponding <a>event handler event types</a>) that
        MUST be supported as attributes by the <a>MobileMessagingManager</a> object.
        
        <table class="simple">
          <thead>
            <tr>
              <th>event handler</th>
              <th>event handler event type</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><strong><code>onreceived</code></strong></td>
              <td><code><dfn>received</dfn></code></td>
            </tr>
            <tr>
              <td><strong><code>onsent</code></strong></td>
              <td><code><dfn>sent</dfn></code></td>
            </tr>
            <tr>
              <td><strong><code>ondeliverysuccess</code></strong></td>
              <td><code><dfn>deliverysuccess</dfn></code></td>
            </tr>
            <tr>
              <td><strong><code>ondeliveryfailure</code></strong></td>
              <td><code><dfn>deliveryfailure</dfn></code></td>
            </tr>
          </tbody>
        </table>

        <p>The <code>received</code> and <code>sent</code> <a>events</a> SHALL implement the <a>MessagingEvent</a> interface
        whereas the <code>deliverysuccess</code> and <code>deliveryfailure</code> <a>events</a> SHALL implement the
        <a>MessagingDeliveryReportEvent</a> interface.

      </section>
    </section>

    <section>
      <h2><a>SmsSegmentInfo</a> Interface</h2>
      <p>The <a>SmsSegmentInfo</a> interface contians information about the segmentation of a given text to be sent as SMS.
      <dl title="[NoInterfaceObject]
                 interface SmsSegmentInfo"
          class="idl">
        <dt>readonly attribute long segments</dt>
        <dd>Indicates the total number of SMS segments needed to send the input string.</dd>

        <dt>readonly attribute long charsPerSegment</dt>
        <dd>Indicates number of characters available per SMS segment as per the encoding to be used to send the SMS
        message.</dd>

        <dt>readonly attribute long charsAvailableInLastSegment</dt>
        <dd>Indicates the maximum number of available characters in the last segment needed to send the input string</dd>

      </dl>
    </section>    
    
    <section>
      <h2><a>MessagingRequest</a> Interface</h2>
      <p>The <a>MessagingRequest</a> interface represents an ongoing operation. It provides callbacks that are called when
      the operation completes, as well as a reference to the operation's result. A method that initiates an operation
      (e.g. delete message via the <code>delete</code> method in the <code>MobileMessagingManager</code> interface) MUST return a
      MessagingRequest object that can be used to monitor the progress of that operation.
      <dl title="[NoInterfaceObject]
                 interface MessagingRequest"
          class="idl">
        <dt>readonly attribute DOMString readyState</dt>
        <dd>Indicates the state of the request, with possible string values 'processing',if the request has been made and it
        is progressing, or 'done', if the request has been already completed.</dd>

        <dt>readonly attribute DOMError? error</dt>
        <dd>An error that occured during the request. Errors are as defined in [[!DOM4]].</dd>

        <dt>readonly attribute any? result</dt>
        <dd>Indicates the result of the request. The type depends on the sort of request, and is specified in the
        description of each method that returns a <code>MessagingRequest</code> object, e.g. <code>delete</code> method of the
        <code>MobileMessagingManager</code> object.</dd>

        <dt class="no-docs">
          attribute EventHandler onsuccess
        </dt>
        <dd></dd>

        <dt class="no-docs">
          attribute EventHandler onerror
        </dt>
        <dd></dd>
      </dl>

      <section>
        <h2>Event handlers</h2>
        <p>
          The following are the <a>event handlers</a> (and their corresponding <a>event handler event types</a>) that
          MUST be supported as attributes by the <a>MessagingRequest</a> object:
        <table class="simple">
          <thead>
            <tr>
              <th>event handler</th>
              <th>event handler event type</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><strong><code>onsuccess</code></strong></td>
              <td><code><dfn>success</dfn></code></td>
            </tr>
            <tr>
              <td><strong><code>onerror</code></strong></td>
              <td><code><dfn>error</dfn></code></td>
            </tr>
          </tbody>
        </table>
      </section>
    </section>

    <section>
      <h2><a>SmsMessage</a> Interface</h2>
      <p>The <a>SmsMessage</a> interface represents a sent or received SMS message. This interface is not intended to
      represent binary SMS, which are out of the scope of this API.
      <dl title="[NoInterfaceObject]
                 interface SmsMessage"
          class="idl">
        <dt>readonly attribute DOMString type</dt>
        <dd>The type of message. This attribute always has the value 'sms' in SmsMessage objects.</dd>

        <dt>readonly attribute long id</dt>
        <dd>An identifier of the message that is unique in the frame of the user agent.</dd>

        <dt>readonly attribute DOMString state</dt>
        <dd>Indicates whether the message has been received (string value 'received'), sent (string value 'sent'),
        is in process of being sent (string value 'sending') or an error has happened during the sending process
        (string value 'error')</dd>

        <dt>readonly attribute DOMString sender</dt>
        <dd>Indicates the sender of the message.</dd>

        <dt>readonly attribute DOMString recipient</dt>
        <dd>Indicates the recipient of the message.</dd>
        
        <dt>readonly attribute Date timestamp</dt>
        <dd>Indicates the time the message was sent at.</dd>

        <dt>readonly attribute DOMString? deliveryStatus</dt>
        <dd>Indicates whether an SMS message has been succesfully delivered to the recipient ('success'), it is pending
        delivery ('pending'), the delivery has failed ('error') or this attribute is not applicable because a delivery
        report has not been requested ('not-applicable'). This attribute returns <code>null </code> for the case of inbound
        messages.
        </dd>
        
        <dt>readonly attribute DOMString messageClass</dt>
        <dd>Indicates the SMS message class: 'class-0', 'class-1', 'class-2', 'class-3' or 'normal' (same as 'class-1').</dd>
        
        <dt>readonly attribute boolean read</dt>
        <dd>Indicates whether the message has been marked as read (value 'true') or not (value 'false').</dd>
        
        <dt>readonly attribute SmsContent content</dt>
        <dd>Contains the content (i.e. the text) of the SMS message.</dd>
      </dl>
    </section>

    <section>
      <h2><a>SmsContent</a> Dictionary</h2>
      <dl title="dictionary SmsContent" class="idl">
        <dt>attribute DOMString text</dt>
        <dd>Indicates the text of the SMS message.</dd>
      </dl>    
    </section>

    <section>
      <h2><a>MmsMessage</a> Interface</h2>
      <p>The <a>MmsMessage</a> interface represents a sent or received SMS message.
      <dl title="[NoInterfaceObject]
                 interface MmsMessage"
          class="idl">
        <dt>readonly attribute DOMString type</dt>
        <dd>The type of message. This attribute always has the value 'mms' in MmsMessage objects.</dd>

        <dt>readonly attribute long id</dt>
        <dd>An identifier of the message that is unique in the frame of the user agent.</dd>

        <dt>readonly attribute DOMString state</dt>
        <dd>Indicates whether a notification of the message has been received but the message has not yet been downloaded
        (string value 'not-downloaded') or whether the message has been received and downloaded (string value 'received'),
        sent (string value 'sent'), is in process of being sent (string value 'sending') or an error has happened during
        the sending process (string value 'error')</dd>

        <dt>readonly attribute DOMString sender</dt>
        <dd>Indicates the sender of the message.</dd>

        <dt>readonly attribute DOMString[] recipients</dt>
        <dd>Indicates the recipient(s) of the message.</dd>

        <dt>readonly attribute Date timestamp</dt>
        <dd>Indicates the time the message was sent at.</dd>

        <dt>readonly attribute DOMString[]? deliveryStatus</dt>
        <dd>An array with an element per recipient of the MMS Message indicating, in the same order as the <code>recipients</code>
        element, whether an MMS message has been succesfully delivered to the recipient ('success'), it is pending
        delivery / pending download at destination ('pending'), the delivery has failed ('error') or this attribute is
        not applicable because a delivery report has not been requested ('not-applicable'). This attribute is just to be
        filled for the case of outbound messages.
        </dd>

        <dt>readonly attribute boolean read</dt>
        <dd>Indicates whether the message has been marked as read (value 'true') or not (value 'false').</dd>

        <dt>readonly attribute MmsContent content</dt>
        <dd>Contains the content of the MMS message (i.e. subject, presentation element and attachments).</dd>
      </dl>
    </section>

    <section>
      <h2><a>MmsContent</a> Dictionary</h2>
      <dl title="dictionary MmsContent" class="idl">
        <dt>optional attribute DOMString subject</dt>
        <dd>Indicates the subject of the MMS message.</dd>

        <dt>optional attribute Document smil</dt>
        <dd>Contains the SMIL component, i.e. the presentation element that determines the way the content of the
        MMS message MUST be displayed.</dd>

        <dt>attribute MmsAttachment[] attachments</dt>
        <dd>Contains the set of attachements of the MMS message.</dd>
      </dl>    
    </section>
    
    <section>
      <h2><a>MmsAttachment</a> Dictionary</h2>
      <dl title="dictionary MmsAttachment" class="idl">
        <dt>optional attribute DOMString contentId</dt>
        <dd>
        The Content-ID parameter that MAY be used to refer to the attachement from the SMIL presentation object.
        At least one of Content-ID and Content-Location needs to be specified if the MMS Message contains an SMIL
        presentation object.        
        </dd>
        <dt>optional attribute DOMString contentLocation</dt>
        <dd>
        The Content-Location parameter that MAY be used to refer to the attachement from the SMIL presentation object.
        At least one of Content-ID and Content-Location needs to be specified if the MMS Message contains an SMIL
        presentation object.        
        It may also be used as a hint to define the filename when the attachment is stored at the file system.
        </dd>
        <dt>attribute Blob content</dt>
        <dd>
        The Blob object containing the media type and the binary content of the attachement
        </dd>
      </dl>    
    </section>
    
    <section>
      <h2><a>MessagingCursor</a> Interface</h2>
      <p>The <a>MessagingCursor</a> interface allows to iterate through a list of <code>SmsMessage</code> and/or
      <code>MmsMessage</code> elements.</p>
      <p>A <a>MessagingCursor</a> always has, an <dfn>associated request</dfn> which is the <a>MessagingRequest</a> that created it.
      In other words, a <a>MessagingCursor</a> is always the <code>result</code> of a <a>MessagingRequest</a> and can't be created in
      any other way.</p>
      <p>As soon as the <a>MessagingCursor</a> is <dfn>accessing the next message</dfn>, it MUST put its <a>associated request</a>
      in the 'processing' <code>readyState</code>, and set the <code>result</code> to null. Then, the UA MUST fetch the
      next message asynchronously. When the message is retrieved, the <a>associated request</a>'s <code>readyState</code>
      must be set to 'done' and the <code>result</code> must point to the cursor. If no message was found, the cursor's
      <code>message</code> property must return null.</p>
      <dl title="[NoInterfaceObject]
                 interface MessagingCursor"
          class="idl">
        <dt>readonly attribute any? message</dt>
        <dd>
          This property MUST return the currently accessed message. If the cursor went past the last message or if it
          is currently <a>accessing the next message</a>, it MUST return null.
        </dd>
        <dt>void continue()</dt>
        <dd>
          When this method is called, the cursor MUST change its internal state to <a>accessing the next message</a>.<br>
          If this method is called while the cursor is <a>accessing the next message</a>, the method MUST throw an
          <code>"InvalidStateError"</code> error as defined in [[!DOM4]].
        </dd>
      </dl>
    </section>
    
    <section>
      <h2><a>MessagingFilter</a> Interface</h2>
      <p>The <a>MessagingFilter</a> interface represents a filter that is used to select a set of messages (e.g. to be
      provided upon invoking a <code>getMessages</code> method in the <code>MobileMessagingManager</code> interface).
      <dl title="[NoInterfaceObject]
                 interface MessagingFilter"
          class="idl">
        <dt>attribute Date? startDate</dt>
        <dd>Indicates that messages with timestamp previous to this date will not be provided in the results of this
        filter.</dd>

        <dt>attribute Date? endDate</dt>
        <dd>Indicates that messages with timestamp after this date will not be provided in the results of this
        filter.</dd>

        <dt>attribute DOMString? sender</dt>
        <dd>Indicates that just messages sent from this number are to be provided in the results
        of this filter.</dd>

        <dt>attribute DOMString[]? recipients</dt>
        <dd>Indicates that just messages sent to one of these numbers are to be provided in the results
        of this filter.</dd>

        <dt>attribute DOMString? state</dt>
        <dd>Indicates whether the results of this filter just needs to return the messages that have been received
        ('received'), sent ('sent'), are in process of being sent ('sending'), for which an error has happened during
        the sending process ('error') or for which a notification has been received but the message (just of MMS type)
        has not yet been downloaded ('not-downloaded').
        
        </dd>

        <dt>attribute boolean? read</dt>
        <dd>Indicates whether just read or unread messages are to be provided in the results of this filter,
        respectively if it is set to 'true' or 'false'</dd>

        <dt>attribute DOMString? type</dt>
        <dd>Indicates whether just the SMS or MMS messages are to be provided in the results of this filter, respectively
        if it is set to string value 'SMS' or 'MMS'
        </dd>

      </dl>
    </section>
    
    <section>
      <h2><a>MessagingEvent</a> Interface</h2>
      <p>The <a>MessagingEvent</a> interface represents events related to a message sent or received.
      <dl title="[NoInterfaceObject]
                 interface MessagingEvent : Event"
          class="idl">
        <dt>readonly attribute any message</dt>
        <dd>Contains the <code>SmsMessage</code> or <code>SmsMessage</code> object to which this event is related.</dd>
      </dl>
    </section>

    <section>
      <h2><a>MessagingDeliveryReportEvent</a> Interface</h2>
      <p>The <a>MessagingDeliveryReportEvent</a> interface represents events related to a delivery report of a sent message.
      <dl title="[NoInterfaceObject]
                 interface MessagingDeliveryReportEvent : Event"
          class="idl">
        <dt>readonly attribute long id</dt>
        <dd>Indicates the identifier of the SMS or MMS message to which this delivery report event is related.</dd>
        <dt>readonly attribute DOMString[] recipients</dt>
        <dd>Indicates the addresses of the subset of the original recipients of the message to which this delivery report event is related.
        As delivery reports related to just part of the message recipients are possible, this array may not contain the
        full list of recipients to which the message was sent.
        </dd>
      </dl>
    </section>

    <section>
      <h2>Acknowledgements</h2>
      <p>The editors would like to express their gratitude to the Mozilla B2G Team for their technical guidance, implementation work and support</p>
    </section>
    
    
  </body>
</html>
